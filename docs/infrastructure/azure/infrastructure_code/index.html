<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<title data-react-helmet="true">Infrastructure | Amido Stacks</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Infrastructure | Amido Stacks"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><meta data-react-helmet="true" property="og:url" content="https://amido.github.io/stacks/docs/infrastructure/azure/infrastructure_code"><link data-react-helmet="true" rel="shortcut icon" href="/stacks/img/thumbnail_stacks.png"><link data-react-helmet="true" rel="canonical" href="https://amido.github.io/stacks/docs/infrastructure/azure/infrastructure_code"><link rel="stylesheet" href="/stacks/styles.addbe53e.css">
<link rel="preload" href="/stacks/styles.a9aa97cb.js" as="script">
<link rel="preload" href="/stacks/runtime~main.07fe97c7.js" as="script">
<link rel="preload" href="/stacks/main.07e3b808.js" as="script">
<link rel="preload" href="/stacks/1.708654f4.js" as="script">
<link rel="preload" href="/stacks/2.fc96d4af.js" as="script">
<link rel="preload" href="/stacks/3.c611d954.js" as="script">
<link rel="preload" href="/stacks/1be78505.4bc75bd4.js" as="script">
<link rel="preload" href="/stacks/81.27d21960.js" as="script">
<link rel="preload" href="/stacks/935f2afb.6e42c6a8.js" as="script">
<link rel="preload" href="/stacks/17896441.048ebb65.js" as="script">
<link rel="preload" href="/stacks/a9050c51.199cf739.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/stacks/"><img class="navbar__logo" src="/stacks/img/logo.svg" alt="Amido Stacks Logo"><strong class="navbar__title">Amido Stacks</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/stacks/docs/">Docs</a><a href="https://github.com/amido/stacks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/stacks/"><img class="navbar__logo" src="/stacks/img/logo.svg" alt="Amido Stacks Logo"><strong class="navbar__title">Amido Stacks</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/stacks/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/amido/stacks" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/">About Amido Stacks</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Build the application</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/getting_started_demo">Using the scaffolding-cli to build an application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/getting_started_dev">Dev [Node.js]- Using the repo to build the Node.js application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/getting_started_dev_java">Dev [Java] - Using the repo to build the Java application locally</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/getting_started_dev_dotnet">Dev [Dotnet] - Using the repo to build the Dotnet application locally</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Workloads</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/workloads">Workloads</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Frontend Web Applications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/intro_node_js">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/ide_node_js">IDE Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/environment_variables_nodejs">Enviroment Variables</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/cli_webapp_frameworks">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/monorepo">Stacks Monorepo</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/browser_support">Browser Support</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/frontend/server_side_cache">Server Side Cache</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Java Spring Boot REST API Application</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/intro_java">Introduction to the Java REST API application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/quickstart_java">Getting started with the Java Rest API application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/scaffolding_java">Using the Scaffolding CLI to create the Java Rest API project template</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/ide_java">IDE guidelines for the Java Rest API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/structure_java">Java Rest API Structure and Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/testing_java">Testing the Java Rest API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/java/end_to_end_testing_java">End to end automation testing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">.NET Core REST API Application</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/introduction_netcore">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/quickstart/requirements_netcore">Requirements</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/quickstart/create_project_netcore">Create the project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/quickstart/configure_project_netcore">Configure the project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/quickstart/build_and_run_project_netcore">Build &amp; Run the Project</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Test</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/quickstart/testing/functional_testing_netcore">Functional testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/quickstart/testing/performance_testing_netcore">Performance testing</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/quickstart/deploy_project_netcore">Deployment</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Swagger Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/quickstart/swagger_configuration/configure_swagger_netcore">Swagger</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/quickstart/swagger_configuration/configure_swagger_ui_netcore">Swagger UI</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/logging_netcore">Logging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/security_netcore">Security</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/project_structure/architecture_overview_netcore">Architecture Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/project_structure/repository_overview_netcore">Repository</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/workloads/netcore/project_structure/project_structure_netcore">Project Structure</a></li></ul></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Infrastructure</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Azure</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/stacks/docs/infrastructure/azure/infrastructure_code">Infrastructure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/stacks/docs/infrastructure/azure/pipeline_templates">Pipeline Templates</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/testing">Testing and quality</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/cli_testing_frameworks">Project Types - Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/testing_serenity_bdd">E2E Serenity BDD Java</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/testing/testing_static">Static Code Analysis</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Packages</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/packages/packages">Packages</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">npm</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/packages/npm/publishing">Publishing Packages</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/packages/npm/scaffolding-cli/cli_process">CLI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/packages/npm/scaffolding-cli/scaffolding_cli">scaffolding-cli</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">nuget</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/packages/nuget/publishing_nuget">Publishing NuGet Packages</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">maven</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/packages/maven/dependency_management">Dependencies and Version Management</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Support</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/stacks/docs/support/faq">FAQ</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Infrastructure</h1></header><div class="markdown"><p>All infrastructure tooling is done with <a href="https://www.terraform.io/" target="_blank" rel="noopener noreferrer">Terraform</a>, as a method for implementing our infrastructure as code. Terraform uses workspaces as the main mechanism of segregating states.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="terraform"></a>Terraform<a aria-hidden="true" tabindex="-1" class="hash-link" href="#terraform" title="Direct link to heading">#</a></h2><p>All the modules used by stacks are documented and maintained <a href="https://github.com/amido/stacks-terraform" target="_blank" rel="noopener noreferrer">here</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="recommended-usage"></a>Recommended Usage<a aria-hidden="true" tabindex="-1" class="hash-link" href="#recommended-usage" title="Direct link to heading">#</a></h3><p>workspaces... </p><p>Optionally create feature based environments by passing...</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="bootstrap-the-azure-tenant"></a>Bootstrap the Azure tenant<a aria-hidden="true" tabindex="-1" class="hash-link" href="#bootstrap-the-azure-tenant" title="Direct link to heading">#</a></h2><p>The first step is to create the Azure tenant and subscription by creating a SPN service account and a storage account for terraform state. This process only needs to be run once run once on an administrators workstation.</p><p>The administrator will need the following permissions:</p><ul><li>Azure AD &quot;Global Administrator&quot; role for the Azure AD Tenant</li><li>IAM subscription owner</li></ul><p>With owner privileges:</p><ol><li>Create a <a href="https://azure.microsoft.com/en-gb/services/storage/blobs/" target="_blank" rel="noopener noreferrer">Blob Storage instance</a></li><li>Take note of:<ol><li>storage account name</li><li>blob name</li><li>ClientID</li><li>TenantID</li><li>SubscriptionId</li><li>ClientSecret</li></ol></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="security-best-practice-recommendations"></a>Security best practice recommendations<a aria-hidden="true" tabindex="-1" class="hash-link" href="#security-best-practice-recommendations" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="azure"></a>Azure<a aria-hidden="true" tabindex="-1" class="hash-link" href="#azure" title="Direct link to heading">#</a></h4><p>Terraform state - blob storage can be in a different subscription to your solution subscription - which is where your applications and their infra will live
The terraform state subscription should be locked to normal users (developers).</p><p>Users (AAD users) should have only a read-only access to the solution subscription dashboard.</p><p>When initialising terraform&#x27;s backend you will use the tf state subscription credentials and for the provider you will use the solution credentials - this will be an SPN account&#x27;s (`client/tenant/subscription_id and client_secret)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="resolving-lock-state"></a>Resolving lock state<a aria-hidden="true" tabindex="-1" class="hash-link" href="#resolving-lock-state" title="Direct link to heading">#</a></h3><p>Either locally, or in the pipeline, if an error occurs like the following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-log codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error: Error loading state: failed to lock azure state: storage: service returned error: StatusCode=409, ErrorCode=LeaseAlreadyPresent, ErrorMessage=There is already a lease present.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RequestId:REQUEST_ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Time:0000-00-00T00:00:00.0000000Z, RequestInitiated=Weekday, Day Month YYYY 00:00:00 GMT, RequestId=0000000-0000-0000-0000-000000000000, API Version=YYYY-MM-DD, QueryParameterName=, QueryParameterValue=</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Lock Info:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ID:        0000000-0000-0000-0000-000000000000</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Path:      tfstate/amido-stacks-menuenv:amido-stacks-menu-test</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Operation: OperationTypeApply</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Who:       vsts@fv-az692</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Version:   0.00.00</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Created:   0000-00-00T00:00:00.0000000 +0000 UTC</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Info:      </span></div></div></div></div></div><p>We recommend resolving this through the CLI rather than the Portal interface.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">az storage blob lease </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">break</span><span class="token plain"> -b </span><span class="token variable" style="color:rgb(191, 199, 213)">$KEY_NAME</span><span class="token plain"> -c </span><span class="token variable" style="color:rgb(191, 199, 213)">$BLOB_NAME</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> --account-name </span><span class="token variable" style="color:rgb(191, 199, 213)">$STORAGE_ACC_NAME</span><span class="token plain"> --account-key </span><span class="token variable" style="color:rgb(191, 199, 213)">$STORAGE_ACC_KEY</span></div></div></div></div></div><p>On success, exit code 0 to be returned.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="azure-devops-pipelines"></a>Azure Devops Pipelines<a aria-hidden="true" tabindex="-1" class="hash-link" href="#azure-devops-pipelines" title="Direct link to heading">#</a></h2><p>See <a href="/stacks/docs/infrastructure/azure/pipeline_templates">Pipeline Templates</a> for more information about our open sourced steps.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="contributing"></a>Contributing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#contributing" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="running-locally"></a>Running Locally<a aria-hidden="true" tabindex="-1" class="hash-link" href="#running-locally" title="Direct link to heading">#</a></h4><p>To test the deploy folder has been correctly provisioned prior to checking
you need to at this point in time copy over a sample backend-config and
terraform vars. Currently vars.tf and provider configuration is not
automatically updated. Future iterations will include this.</p><p>The safest way to run and maintain this going forward is to rely on environment
variables for credentials as that is the way the pipeline will trigger the
executions of terraform.</p><p>Sample export script with correct environment vars:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#WINDOWS: comment out the lines below</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ARM_CLIENT_ID</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ARM_CLIENT_SECRET</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ARM_SUBSCRIPTION_ID</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">ARM_TENANT_ID</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">##########################################################</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#WINDOWS: uncomment the following lines and fill in values</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Set-Variable -Name &quot;ARM_CLIENT_ID&quot; -Value &quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Set-Variable -Name &quot;ARM_CLIENT_SECRET&quot; -Value &quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Set-Variable -Name &quot;ARM_SUBSCRIPTION_ID&quot; -Value &quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Set-Variable -Name &quot;ARM_TENANT_ID&quot; -Value &quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">##########################################################</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">vnet_id                 = </span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)">amido-stacks-vnet-uks-dev</span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">rg_name                 = </span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)">amido-stacks-rg-uks-dev</span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">resource_group_location = </span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)">uksouth</span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">name_company            = </span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)">amido</span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">name_project            = </span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)">stacks</span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">name_component          = </span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)">spa</span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">name_environment        = </span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)">dev</span><span class="token string entity" style="color:rgb(195, 232, 141)">\&quot;</span><span class="token string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">${YOUR_GIT_STACKS_WEB_APP_PATH}</span><span class="token plain">/stacks-webapp-template/deploy/terraform/azure/backend.local.tfvars</span></div></div></div></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">${YOUR_GIT_STACKS_WEB_APP_PATH}</span><span class="token plain">/deploy/terraform/azure</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">terraform init -backend-config</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">./backend.local.tfvars</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">terraform plan</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/amido/stacks/docs/infrastructure/azure/infrastructure_code.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/stacks/docs/workloads/netcore/project_structure/project_structure_netcore"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Project Structure</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/stacks/docs/infrastructure/azure/pipeline_templates"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Pipeline Templates Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#terraform" class="table-of-contents__link">Terraform</a><ul><li><a href="#recommended-usage" class="table-of-contents__link">Recommended Usage</a></li></ul></li><li><a href="#bootstrap-the-azure-tenant" class="table-of-contents__link">Bootstrap the Azure tenant</a><ul><li><a href="#security-best-practice-recommendations" class="table-of-contents__link">Security best practice recommendations</a></li><li><a href="#resolving-lock-state" class="table-of-contents__link">Resolving lock state</a></li></ul></li><li><a href="#azure-devops-pipelines" class="table-of-contents__link">Azure Devops Pipelines</a><ul><li><a href="#contributing" class="table-of-contents__link">Contributing</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/stacks/docs/">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">About Us</h4><ul class="footer__items"><li class="footer__item"><a href="https://amido.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Amido</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Open Source</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/amido/stacks" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 Amido Ltd</div></div></div></footer></div>
<script src="/stacks/styles.a9aa97cb.js"></script>
<script src="/stacks/runtime~main.07fe97c7.js"></script>
<script src="/stacks/main.07e3b808.js"></script>
<script src="/stacks/1.708654f4.js"></script>
<script src="/stacks/2.fc96d4af.js"></script>
<script src="/stacks/3.c611d954.js"></script>
<script src="/stacks/1be78505.4bc75bd4.js"></script>
<script src="/stacks/81.27d21960.js"></script>
<script src="/stacks/935f2afb.6e42c6a8.js"></script>
<script src="/stacks/17896441.048ebb65.js"></script>
<script src="/stacks/a9050c51.199cf739.js"></script>
</body>
</html>